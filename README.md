# Policr Mini - æ™ºèƒ½ Telegram ç¾¤ç»„éªŒè¯æœºå™¨äºº

[![status-badge](https://arm-ci.hentioe.dev/api/badges/1/status.svg)](https://arm-ci.hentioe.dev/repos/1)
[![GitHub issues](https://img.shields.io/github/issues/Hentioe/policr-mini)](https://github.com/Hentioe/policr-mini/issues)
![Languages top](https://img.shields.io/github/languages/top/Hentioe/policr-mini)
![GitHub](https://img.shields.io/github/license/Hentioe/policr-mini)

[åŠ å…¥ç¾¤ç»„](https://t.me/policr_community) | [æ›´æ–°é¢‘é“](https://t.me/policr_changelog) | [å®˜æ–¹æœºå™¨äºº](https://t.me/policr_mini_bot) | [èµåŠ©é¡¹ç›®](https://mini.gramlabs.org/?sponsorship)

## ğŸš€ ç®€ä»‹

Policr Mini æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Telegram ç¾¤ç»„ç®¡ç†æœºå™¨äººï¼Œä¸“æ³¨äºæä¾›æ™ºèƒ½çš„æ–°æˆå‘˜éªŒè¯å’Œç¾¤ç»„ç®¡ç†åŠŸèƒ½ã€‚å®ƒå¯ä»¥æœ‰æ•ˆé˜²æ­¢åƒåœ¾ç”¨æˆ·å’Œæœºå™¨äººè´¦å·çš„å…¥ä¾µï¼Œä¿æŠ¤æ‚¨çš„ç¾¤ç»„å®‰å…¨ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **ğŸ›¡ï¸ æ™ºèƒ½éªŒè¯ç³»ç»Ÿ**
  - å¤šç§éªŒè¯æ¨¡å¼ï¼šå›¾ç‰‡éªŒè¯ã€ç®—æœ¯éªŒè¯ã€è‡ªå®šä¹‰é—®ç­”
  - æ”¯æŒåŠ å…¥è¯·æ±‚å’Œç›´æ¥åŠ å…¥ä¸¤ç§æ–¹å¼
  - éªŒè¯å¤±è´¥è‡ªåŠ¨é‡è¯•æœºåˆ¶
  - æƒé™é—®é¢˜è‡ªåŠ¨ä¿®å¤

- **ğŸš« ååƒåœ¾æ¶ˆæ¯**
  - å®æ—¶æ£€æµ‹åˆ·å±è¡Œä¸º
  - é‡å¤æ¶ˆæ¯è‡ªåŠ¨è¯†åˆ«
  - å¯é…ç½®çš„å¤„ç†æ–¹å¼ï¼ˆç¦è¨€/è¸¢å‡º/å°ç¦ï¼‰
  - æ™ºèƒ½æ—¶é—´çª—å£åˆ†æ

- **ğŸ‘‹ æ¬¢è¿æ¶ˆæ¯å®šåˆ¶**
  - æ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼ï¼ˆHTML/Markdownï¼‰
  - å¯æ·»åŠ è‡ªå®šä¹‰æŒ‰é’®
  - æ”¯æŒå›¾ç‰‡å’Œå˜é‡æ›¿æ¢
  - æ¶ˆæ¯è‡ªåŠ¨åˆ é™¤åŠŸèƒ½

- **âš¡ ç®¡ç†å‘½ä»¤**
  - `/ban` - å°ç¦ç”¨æˆ·
  - `/mute` - ç¦è¨€ç”¨æˆ·
  - `/unmute` - è§£é™¤ç¦è¨€
  - `/kick` - è¸¢å‡ºç”¨æˆ·
  - æ”¯æŒæ—¶é•¿è®¾ç½®ï¼ˆ5m/2h/1dï¼‰

- **ğŸ“Š Web æ§åˆ¶å°**
  - å®æ—¶æ•°æ®ç»Ÿè®¡
  - éªŒè¯å†å²æŸ¥è¯¢
  - ç¾¤ç»„è®¾ç½®ç®¡ç†
  - ç§»åŠ¨ç«¯å‹å¥½ç•Œé¢

## ğŸ¯ é€‚ç”¨åœºæ™¯

- å¤§å‹å…¬å¼€ç¾¤ç»„çš„æˆå‘˜ç®¡ç†
- ç¤¾åŒºç¾¤ç»„çš„åƒåœ¾ä¿¡æ¯é˜²æŠ¤
- ç§å¯†ç¾¤ç»„çš„æˆå‘˜å®¡æ ¸
- å•†ä¸šç¾¤ç»„çš„ç”¨æˆ·éªŒè¯

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Elixir 1.14+ 
- Erlang/OTP 25+
- PostgreSQL 13+
- Redis 6+ (å¯é€‰ï¼Œç”¨äºç¼“å­˜)
- Docker & Docker Compose (æ¨è)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å®˜æ–¹æœºå™¨äºº

1. å°† [@policr_mini_bot](https://t.me/policr_mini_bot) æ·»åŠ åˆ°æ‚¨çš„ç¾¤ç»„
2. å°†æœºå™¨äººè®¾ç½®ä¸ºç®¡ç†å‘˜ï¼Œå¹¶èµ‹äºˆä»¥ä¸‹æƒé™ï¼š
   - åˆ é™¤æ¶ˆæ¯
   - å°ç¦ç”¨æˆ·
   - é‚€è¯·ç”¨æˆ·ï¼ˆå¯é€‰ï¼Œç”¨äºè§£å°ï¼‰
3. æœºå™¨äººä¼šè‡ªåŠ¨å¼€å§‹å·¥ä½œ

### æ–¹å¼äºŒï¼šDocker éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/Hentioe/policr-mini.git
cd policr-mini
```

2. å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
```bash
cp dev.env.example prod.env
```

3. ç¼–è¾‘ `prod.env` æ–‡ä»¶ï¼Œè®¾ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼š
```env
# Telegram Bot Token
TG_BOT_TOKEN=your_bot_token_here

# æ•°æ®åº“é…ç½®
DB_HOST=postgres
DB_PORT=5432
DB_NAME=policr_mini
DB_USER=policr_mini
DB_PASS=your_secure_password

# ç®¡ç†å‘˜ç”¨æˆ· IDï¼ˆä» @userinfobot è·å–ï¼‰
TG_OWNER_ID=your_telegram_id

# Web ç•Œé¢é…ç½®
WEB_HOST=0.0.0.0
WEB_PORT=4000
SECRET_KEY_BASE=your_64_char_secret_key
```

4. å¯åŠ¨æœåŠ¡
```bash
docker-compose up -d
```

5. è®¿é—® Web æ§åˆ¶å°
- åœ°å€ï¼š`http://your-server-ip:4000`
- ä½¿ç”¨ `/login` å‘½ä»¤åœ¨æœºå™¨äººç§èŠä¸­è·å–ç™»å½•é“¾æ¥

## ğŸ“š ä½¿ç”¨æŒ‡å—

### æœºå™¨äººå‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ | æƒé™ |
|------|------|-------|
| `/start` | å¯åŠ¨æœºå™¨äºº | æ‰€æœ‰ç”¨æˆ· |
| `/ping` | æ£€æŸ¥æœºå™¨äººçŠ¶æ€ | æ‰€æœ‰ç”¨æˆ· |
| `/login` | è·å– Web æ§åˆ¶å°ç™»å½•é“¾æ¥ | ç¾¤ç®¡ç†å‘˜ |
| `/sync` | åŒæ­¥ç¾¤ç»„ä¿¡æ¯ | ç¾¤ç®¡ç†å‘˜ |
| `/ban @user [time]` | å°ç¦ç”¨æˆ· | ç¾¤ç®¡ç†å‘˜ |
| `/mute @user [time]` | ç¦è¨€ç”¨æˆ· | ç¾¤ç®¡ç†å‘˜ |
| `/unmute @user` | è§£é™¤ç¦è¨€ | ç¾¤ç®¡ç†å‘˜ |
| `/kick @user` | è¸¢å‡ºç”¨æˆ· | ç¾¤ç®¡ç†å‘˜ |

### éªŒè¯æ–¹å¼é…ç½®

1. **å›¾ç‰‡éªŒè¯**ï¼ˆé»˜è®¤ï¼‰
   - ç”¨æˆ·éœ€è¦ä»å¤šå¼ å›¾ç‰‡ä¸­é€‰æ‹©æ­£ç¡®çš„ç­”æ¡ˆ
   - é€‚åˆå¤§å¤šæ•°ç¾¤ç»„

2. **ç®—æœ¯éªŒè¯**
   - ç®€å•çš„åŠ æ³•è®¡ç®—
   - é€‚åˆå¿«é€ŸéªŒè¯

3. **è‡ªå®šä¹‰é—®ç­”**
   - ç®¡ç†å‘˜å¯ä»¥è®¾ç½®è‡ªå®šä¹‰é—®é¢˜å’Œç­”æ¡ˆ
   - é€‚åˆç‰¹å®šä¸»é¢˜ç¾¤ç»„

### ååƒåœ¾é…ç½®

é€šè¿‡ Web æ§åˆ¶å°é…ç½®ï¼š

- **æ£€æµ‹æ—¶é—´çª—å£**ï¼š60 ç§’ï¼ˆé»˜è®¤ï¼‰
- **æœ€å¤§æ¶ˆæ¯æ•°**ï¼š10 æ¡
- **æœ€å¤§é‡å¤æ¶ˆæ¯**ï¼š3 æ¡
- **å¤„ç†æ–¹å¼**ï¼šç¦è¨€/è¸¢å‡º/å°ç¦

### æ¬¢è¿æ¶ˆæ¯å˜é‡

| å˜é‡ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `{user_id}` | ç”¨æˆ· ID | `123456789` |
| `{username}` | ç”¨æˆ·å | `@example_user` |
| `{first_name}` | åå­— | `John` |
| `{last_name}` | å§“æ° | `Doe` |
| `{full_name}` | å…¨å | `John Doe` |
| `{mention}` | æåŠç”¨æˆ· | `<a href="tg://user?id=123">John Doe</a>` |

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®åº“è¿ç§»

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼š

```bash
# Docker ç¯å¢ƒ
docker-compose exec app mix ecto.migrate

# æ‰‹åŠ¨éƒ¨ç½²
MIX_ENV=prod mix ecto.migrate
```

### å¤‡ä»½ä¸æ¢å¤

```bash
# å¤‡ä»½æ•°æ®åº“
docker-compose exec postgres pg_dump -U policr_mini policr_mini > backup.sql

# æ¢å¤æ•°æ®åº“
docker-compose exec -T postgres psql -U policr_mini policr_mini < backup.sql
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹æ—¥å¿—

```bash
# Docker æ—¥å¿—
docker-compose logs -f app

# systemd æ—¥å¿—
journalctl -u policr-mini -f
```

### æ€§èƒ½ç›‘æ§

é¡¹ç›®å†…ç½®äº† Telemetry æ”¯æŒï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹ï¼š

- è®¿é—® `http://your-server:4000/dashboard` ï¼ˆéœ€è¦ç™»å½•ï¼‰
- ä½¿ç”¨ Prometheus + Grafana è¿›è¡Œç›‘æ§

## ğŸŒ API æ–‡æ¡£

### è®¤è¯

æ‰€æœ‰ API è¯·æ±‚éœ€è¦åœ¨ Header ä¸­åŒ…å«ï¼š

```
Authorization: Bearer YOUR_TOKEN
```

### ä¸»è¦ç«¯ç‚¹

- `GET /admin/api/chats` - è·å–ç¾¤ç»„åˆ—è¡¨
- `GET /admin/api/chats/:id/scheme` - è·å–ç¾¤ç»„æ–¹æ¡ˆ
- `PUT /admin/api/chats/:id/scheme` - æ›´æ–°ç¾¤ç»„æ–¹æ¡ˆ
- `GET /admin/api/chats/:id/anti_spam_config` - è·å–ååƒåœ¾é…ç½®
- `PUT /admin/api/chats/:id/anti_spam_config` - æ›´æ–°ååƒåœ¾é…ç½®
- `GET /admin/api/chats/:id/welcome_message` - è·å–æ¬¢è¿æ¶ˆæ¯
- `PUT /admin/api/chats/:id/welcome_message` - æ›´æ–°æ¬¢è¿æ¶ˆæ¯

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å®‰è£…ä¾èµ–
mix deps.get
cd assets && npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
mix phx.server
```

## ğŸ“§ è”ç³»æ–¹å¼

- **Telegram ç¾¤ç»„**: [@policr_community](https://t.me/policr_community)
- **æ›´æ–°é¢‘é“**: [@policr_changelog](https://t.me/policr_changelog)
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/Hentioe/policr-mini/issues)

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦æƒ…è¯·æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ™ é¸£è°¢

- æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…
- æ„Ÿè°¢ [Telegex](https://github.com/telegex/telegex) æä¾›çš„ Telegram Bot API æ”¯æŒ
- æ„Ÿè°¢æ‰€æœ‰ä½¿ç”¨å’Œæ”¯æŒæœ¬é¡¹ç›®çš„ç”¨æˆ·

## ğŸ† æ›´æ–°æ—¥å¿—

### v0.8.0 (2024-01-18)
- âœ… ä¿®å¤ç”¨æˆ·éªŒè¯åæƒé™è®¾ç½®å¤±è´¥çš„é—®é¢˜
- âœ… æ–°å¢ååƒåœ¾æ¶ˆæ¯æ£€æµ‹åŠŸèƒ½
- âœ… æ–°å¢ç®¡ç†å‘½ä»¤ /ban /mute /unmute /kick
- âœ… æ–°å¢æ¬¢è¿æ¶ˆæ¯å®šåˆ¶åŠŸèƒ½
- ğŸ”§ ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### æ›´å¤šå†å²ç‰ˆæœ¬

è¯·æŸ¥çœ‹ [CHANGELOG.md](CHANGELOG.md)